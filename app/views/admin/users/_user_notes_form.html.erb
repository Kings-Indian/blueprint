<%= turbo_frame_tag "user_notes_#{user.id}" do %>
  <div id="user_notes_flash_#{user.id}" class="mb-4">
    <% if flash[:notice] %>
      <div class="p-3 bg-bp-success/20 border-2 border-bp-success rounded text-bp-success">
        <%= flash[:notice] %>
      </div>
    <% end %>
    <% if flash[:alert] %>
      <div class="p-3 bg-bp-danger/20 border-2 border-bp-danger rounded text-bp-danger">
        <%= flash[:alert] %>
      </div>
    <% end %>
  </div>
  
  <% if local_assigns[:conflict] %>
    <div class="mb-4 space-y-4">
      <div class="p-4 bg-bp-warning/20 border-2 border-bp-warning rounded">
        <p class="font-bold text-bp-warning mb-2">⚠️ Conflict Detected</p>
        <p class="text-sm">Another reviewer updated these notes while you were editing. Review both versions below.</p>
      </div>
      
      <div class="p-3 bg-bp-dark/50 border border-white/30 rounded">
        <p class="font-bold mb-2">Current Notes (in database):</p>
        <p class="whitespace-pre-wrap"><%= local_assigns[:current_notes] || "(empty)" %></p>
      </div>
      
      <div class="p-3 bg-bp-dark/50 border border-white/30 rounded">
        <p class="font-bold mb-2">Your Changes:</p>
        <p class="whitespace-pre-wrap"><%= local_assigns[:attempted_notes] || "(empty)" %></p>
      </div>
    </div>
  <% end %>
  
  <%= form_with model: user, url: admin_user_path(user), method: :patch, html: { class: "space-y-4" } do |f| %>
    <%= f.hidden_field :internal_notes_original, value: user.internal_notes %>
    <%= f.text_area :internal_notes, rows: 3, placeholder: "Add internal notes about this user...", class: "input px-3 block w-full" %>
    <%= f.submit "Save Notes", class: "btn btn-primary" %>
  <% end %>
<% end %>
